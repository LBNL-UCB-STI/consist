
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Provenance tracking, intelligent caching, and data virtualization for scientific simulation workflows">
      
      
        <meta name="author" content="Zach Needell">
      
      
        <link rel="canonical" href="https://LBNL-UCB-STI.github.io/consist/concepts/caching-and-hydration/">
      
      
        <link rel="prev" href="../decorators-and-metadata/">
      
      
        <link rel="next" href="../data-materialization/">
      
      
        
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="zensical-0.0.23">
    
    
      
        <title>Caching and Artifact Hydration Patterns - Consist</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../assets/stylesheets/modern/main.1e989742.min.css">
      
        
          
        
        <link rel="stylesheet" href="../../assets/stylesheets/modern/palette.dfe2e883.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Franklin:300,300i,400,400i,500,500i,700,700i%7CJetbrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Libre Franklin";--md-code-font:"Jetbrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#caching-and-artifact-hydration-patterns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Consist" class="md-header__button md-logo" aria-label="Consist" data-md-component="logo">
      
  <img src="../../assets/logo-square-dark.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Consist
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Caching and Artifact Hydration Patterns
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-sun-moon" viewBox="0 0 24 24"><path d="M12 2v2M14.837 16.385a6 6 0 1 1-7.223-7.222c.624-.147.97.66.715 1.248a4 4 0 0 0 5.26 5.259c.589-.255 1.396.09 1.248.715M16 12a4 4 0 0 0-4-4M19 5l-1.256 1.256M20 12h2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-moon" viewBox="0 0 24 24"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
    </div>
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../usage-guide/" class="md-tabs__link">
          
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../integrations/" class="md-tabs__link">
          
  
  Integrations

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../troubleshooting/" class="md-tabs__link">
          
  
  Support & Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Consist" class="md-nav__button md-logo" aria-label="Consist" data-md-component="logo">
      
  <img src="../../assets/logo-square-dark.png" alt="logo">

    </a>
    Consist
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/first-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config Management: Caching vs. Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decorators-and-metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decorators &amp; Metadata
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Caching and Artifact Hydration Patterns
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="././" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching and Artifact Hydration Patterns
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terms-used-precisely" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terms Used Precisely
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydration-vs-materialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hydration vs Materialization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hydration vs Materialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-materialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Materialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-electric-grid-modeling-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Electric Grid Modeling Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-behavior-metadata-only-hydration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Behavior: Metadata-Only Hydration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-decision-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Decision Table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signatures-and-cache-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signatures and Cache Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Signatures and Cache Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-identity-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Identity Modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intentional-cache-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intentional Cache Invalidation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifact-identity-vs-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Artifact Identity vs. Bytes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#portability-and-path-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Portability and Path Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-1-step-caching-with-explicit-artifact-handoff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Step Caching with Explicit Artifact Handoff
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern 1: Step Caching with Explicit Artifact Handoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-shaped-steps-skip-on-cache-hit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Function-Shaped Steps (Skip on Cache Hit)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-2-cached-runs-with-consistrun" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Cached Runs with consist.run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-3-resuming-after-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Resuming After Failures
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-4-hot-vs-cold-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Hot vs. Cold Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-happens-on-a-cache-hit" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Happens on a Cache Hit?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What Happens on a Cache Hit?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-tracker-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Tracker Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-misses-with-cached-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Misses with Cached Inputs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-cache-hit-materialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional Cache-Hit Materialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containers-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Containers Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydration-policy-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hydration Policy Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Guidance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practical Guidance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-caching-predictable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Make Caching Predictable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decide-what-to-ingest" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decide What to Ingest
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safe Deletion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-hit-performance-and-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache-Hit Performance and Diagnostics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache-Hit Performance and Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-5-shared-input-bundles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Shared Input Bundles
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern 5: Shared Input Bundles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation-producer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bundle Creation (Producer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bundle-consumption-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bundle Consumption (Consumer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-model-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Model Workflows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-materialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Virtualization &amp; Materialization Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration, Identity, and Facets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dlt-loader-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DLT Loader Integration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Container Integration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mounts-and-portability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mounts &amp; Portability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema-export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schema Export (SQLModel Stubs)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../integrations/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/dlt_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DLT Loader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Config Adapters
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Config Adapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/config_adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/config_adapters_beam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BEAM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/config_adapters_activitysim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ActivitySim
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Support & Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Support & Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../api/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/public_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Public API (v0.1)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/api_helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Helpers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tracker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tracker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Contexts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/artifact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Artifact
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Indexing Helpers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/materialize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Materialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terms-used-precisely" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terms Used Precisely
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydration-vs-materialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hydration vs Materialization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hydration vs Materialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-materialize" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Materialize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-electric-grid-modeling-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Electric Grid Modeling Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-behavior-metadata-only-hydration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Behavior: Metadata-Only Hydration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-decision-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Decision Table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signatures-and-cache-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signatures and Cache Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Signatures and Cache Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-identity-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Identity Modes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intentional-cache-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intentional Cache Invalidation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifact-identity-vs-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Artifact Identity vs. Bytes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#portability-and-path-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Portability and Path Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-1-step-caching-with-explicit-artifact-handoff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Step Caching with Explicit Artifact Handoff
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern 1: Step Caching with Explicit Artifact Handoff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-shaped-steps-skip-on-cache-hit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Function-Shaped Steps (Skip on Cache Hit)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-2-cached-runs-with-consistrun" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Cached Runs with consist.run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-3-resuming-after-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Resuming After Failures
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-4-hot-vs-cold-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Hot vs. Cold Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-happens-on-a-cache-hit" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Happens on a Cache Hit?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What Happens on a Cache Hit?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-tracker-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Tracker Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-misses-with-cached-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Misses with Cached Inputs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-cache-hit-materialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional Cache-Hit Materialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containers-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Containers Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydration-policy-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hydration Policy Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See Also
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Guidance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practical Guidance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-caching-predictable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Make Caching Predictable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decide-what-to-ingest" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decide What to Ingest
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safe Deletion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-hit-performance-and-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache-Hit Performance and Diagnostics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache-Hit Performance and Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-5-shared-input-bundles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Shared Input Bundles
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern 5: Shared Input Bundles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation-producer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bundle Creation (Producer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bundle-consumption-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bundle Consumption (Consumer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-model-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Model Workflows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../overview/" class="md-path__link">
          
  <span class="md-ellipsis">
    Concepts
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  

<h1 id="caching-and-artifact-hydration-patterns">Caching and Artifact Hydration Patterns<a class="headerlink" href="#caching-and-artifact-hydration-patterns" title="Permanent link">&para;</a></h1>
<p>Consist's core loop: declare inputs → compute signature → check cache → load or execute.</p>
<div class="admonition info">
<p class="admonition-title">Terminology</p>
<p><strong>Hydration</strong> recovers metadata and provenance about a prior run's outputs without copying file bytes. <strong>Materialization</strong> ensures file bytes exist on disk (copying them from their original location). A cache hit always hydrates; it only materializes if you request it via a specific hydration policy.</p>
</div>
<p>This page covers patterns for making caching reliable, keeping pipelines portable, and choosing when artifacts should be hydrated or materialized.</p>
<hr />
<h2 id="terms-used-precisely">Terms Used Precisely<a class="headerlink" href="#terms-used-precisely" title="Permanent link">&para;</a></h2>
<p>This page separates <strong>provenance objects</strong> (Artifacts, Runs) from <strong>physical bytes</strong> (files on disk) and <strong>database-backed data</strong> (DuckDB tables).</p>
<p><strong>Cache Hit</strong>: Consist finds a prior run with the same signature and returns cached artifact metadata.</p>
<p><strong>Hydration</strong>: Recovering metadata and location information about a previous run's outputs without copying file bytes.</p>
<p><strong>Materialization</strong>: Copying artifact bytes to disk (or into DuckDB) so files exist in a new location.</p>
<hr />
<h2 id="hydration-vs-materialization">Hydration vs Materialization<a class="headerlink" href="#hydration-vs-materialization" title="Permanent link">&para;</a></h2>
<p>When Consist finds a cached result, it "brings back" information about that result—but what does that mean?</p>
<p>Consider a electric grid simulation in <code>/scratch/simulation_2024/</code> that produces a 50GB results file. Six months later, you run analysis with the same inputs. Consist recognizes a cache hit.</p>
<p><strong>Artifact Hydration</strong> recovers <em>information</em>: the result came from run <code>abc123</code>, it's a Parquet file called <code>results.parquet</code>, it contains monthly precipitation data. Consist creates an <code>Artifact</code> object with metadata, URIs, and provenance.</p>
<p><strong>Materialization</strong> ensures <em>bytes exist</em>: copying the 50GB file from its original location into your new run directory.</p>
<p>Hydration is fast and automatic. Materialization is optional and explicit.</p>
<h3 id="default-behavior">Default Behavior<a class="headerlink" href="#default-behavior" title="Permanent link">&para;</a></h3>
<p>Consist hydrates metadata only. Metadata recovery is instant (database lookup). Files stay in their original location. You pay for copying only when requested.</p>
<p>This matters for parameter sweeps: 100 demand model variations do not require 100 copies of a 50GB input file. Downstream code loads from the original path or database fallback.</p>
<h3 id="when-to-materialize">When to Materialize<a class="headerlink" href="#when-to-materialize" title="Permanent link">&para;</a></h3>
<p>Materialize cached outputs (copy bytes to your current run) in three cases:</p>
<ol>
<li>
<p><strong>Extending a scenario in a new workspace</strong>: Cached results in <code>/workspace/2024</code>, continuing in <code>/workspace/2025</code>. Use <code>cache_hydration="inputs-missing"</code> to copy input files.</p>
</li>
<li>
<p><strong>Preparing outputs for external tools</strong>: Tools expect local files. Use <code>cache_hydration="outputs-requested"</code> with <code>materialize_cached_output_paths</code>. With <code>consist.run(...)</code> or <code>sc.run(...)</code>, use <code>output_paths={...}</code>.</p>
</li>
<li>
<p><strong>Ensuring local reproducibility</strong>: All results accessible without remote mounts. Use <code>cache_hydration="outputs-all"</code> to copy all cached outputs.</p>
</li>
</ol>
<h3 id="example-electric-grid-modeling-workflow">Example: Electric Grid Modeling Workflow<a class="headerlink" href="#example-electric-grid-modeling-workflow" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>  <span class="c1"># (1)!</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="s2">&quot;grid_dispatch_baseline&quot;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;grid_sim&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">year</span><span class="o">=</span><span class="mi">2024</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">cache_mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>  <span class="c1"># (2)!</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">):</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">run_dispatch_model</span><span class="p">()</span>  <span class="c1"># (3)!</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">tracker</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;dispatch&quot;</span><span class="p">)</span>  <span class="c1"># (4)!</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>  <span class="c1"># (5)!</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="s2">&quot;reliability_analysis&quot;</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;analysis&quot;</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">cached_dispatch_artifact</span><span class="p">],</span>  <span class="c1"># (6)!</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span>  <span class="c1"># (7)!</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">):</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result came from run </span><span class="si">{</span><span class="n">cached_dispatch_artifact</span><span class="o">.</span><span class="n">run_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (8)!</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">consist</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">cached_dispatch_artifact</span><span class="p">)</span>  <span class="c1"># (9)!</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>  <span class="c1"># (10)!</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="s2">&quot;export_for_reporting&quot;</span><span class="p">,</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;export&quot;</span><span class="p">,</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;outputs-requested&quot;</span><span class="p">,</span>  <span class="c1"># (11)!</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">materialize_cached_output_paths</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="s2">&quot;dispatch&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./local_outputs/dispatch.parquet&quot;</span><span class="p">)</span>  <span class="c1"># (12)!</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="p">}</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="p">):</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;report_generator&quot;</span><span class="p">,</span> <span class="s2">&quot;annual_summary.py&quot;</span><span class="p">])</span>  <span class="c1"># (13)!</span>
</span></code></pre></div>
<ol>
<li>First run: simulate regional grid dispatch for 2024, takes 18 hours.</li>
<li><strong>Overwrite mode</strong>: Forces re-execution and overwrites any cached results. Use for baseline runs or when upstream data has changed outside Consist's tracking.</li>
<li>Dispatch models produce large outputs—hourly resolution across 8,760 hours for all generators and transmission lines.</li>
<li><strong>Artifact logging</strong>: Consist records the file's hash, location, and lineage. This artifact can now be referenced as an input to downstream runs.</li>
<li>Later: analysis that only needs metadata about the result.</li>
<li><strong>Input declaration</strong>: Tells Consist this run depends on the dispatch artifact. If the upstream run is invalidated, this run's cache is also invalidated.</li>
<li><strong>Metadata-only hydration</strong>: Consist loads the Artifact object (provenance, signatures, URIs) without copying the 40GB file. Default behavior—saves disk space.</li>
<li>Even without file bytes, you can query provenance: which run produced this, when, with what config.</li>
<li><strong>Explicit loading</strong>: When you actually need the data, <code>load_df()</code> reads from the original location (or database if ingested). This is the only point where bytes move.</li>
<li>Later: need to ensure files exist locally for regulatory reporting tool.</li>
<li><strong>Outputs-requested mode</strong>: Tells Consist to copy cached output files to disk. Use when external tools need real files, not just metadata.</li>
<li><strong>Materialization path</strong>: Specifies where Consist should copy the cached artifact. The external reporting tool will find the file here.</li>
<li>Now the regulatory reporting tool can access real files at known paths—Consist handled the copying.</li>
</ol>
<h3 id="default-behavior-metadata-only-hydration">Default Behavior: Metadata-Only Hydration<a class="headerlink" href="#default-behavior-metadata-only-hydration" title="Permanent link">&para;</a></h3>
<p>The default <code>cache_hydration="metadata"</code> performs no filesystem operations and no disk duplication. Use <code>consist.load_df()</code> or <code>consist.load()</code> when you need bytes.</p>
<p>This default suits scientific workflows: large simulations benefit from avoiding disk copies, and provenance verification does not need bytes on disk.</p>
<h3 id="practical-decision-table">Practical Decision Table<a class="headerlink" href="#practical-decision-table" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Your Need</th>
<th>Use This</th>
<th>Tradeoff</th>
</tr>
</thead>
<tbody>
<tr>
<td>Run parameter sweeps on cached simulation</td>
<td><code>metadata</code> (default)</td>
<td>No disk copy; must load data via <code>consist.load_df()</code>/<code>consist.load()</code></td>
</tr>
<tr>
<td>Extend analysis in a new workspace</td>
<td><code>inputs-missing</code></td>
<td>Copies only missing input files; fast on cache hits</td>
</tr>
<tr>
<td>Run external tool that needs local files</td>
<td><code>outputs-requested</code></td>
<td>Copy only what you ask for; must list outputs explicitly</td>
</tr>
<tr>
<td>Ensure all cached data is accessible locally</td>
<td><code>outputs-all</code></td>
<td>Copies everything; uses disk space but guarantees file paths exist</td>
</tr>
</tbody>
</table>
<h3 id="signatures-and-cache-behavior">Signatures and Cache Behavior<a class="headerlink" href="#signatures-and-cache-behavior" title="Permanent link">&para;</a></h3>
<p>Every run's <strong>signature</strong> is derived from code hash, config hash, and input hash. If Consist finds a completed run with the same signature and valid outputs, the new run is a <strong>cache hit</strong> and reuses prior outputs.</p>
<h4 id="code-identity-modes">Code Identity Modes<a class="headerlink" href="#code-identity-modes" title="Permanent link">&para;</a></h4>
<p>By default, code hash uses repository Git state (<code>repo_git</code>). For function-shaped runs, you can opt into callable-scoped code identity with <code>CacheOptions</code>:</p>
<ul>
<li><code>repo_git</code> (default): repository-level hash via Git commit/dirty state.</li>
<li><code>callable_module</code>: hash the module file containing <code>fn</code>.</li>
<li><code>callable_source</code>: hash only <code>fn</code> source text.</li>
<li><code>code_identity_extra_deps</code>: additional relative file paths to fold into callable-scoped hashes.</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">consist</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheOptions</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">fn</span><span class="o">=</span><span class="n">simulate_step</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="s2">&quot;inputs://raw.csv&quot;</span><span class="p">},</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">cache_options</span><span class="o">=</span><span class="n">CacheOptions</span><span class="p">(</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        <span class="n">code_identity</span><span class="o">=</span><span class="s2">&quot;callable_module&quot;</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="n">code_identity_extra_deps</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pilates/common_utils.py&quot;</span><span class="p">],</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="p">),</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="p">)</span>
</span></code></pre></div>
<p>Use callable-scoped modes when unrelated repo edits are causing unnecessary cache misses.</p>
<h4 id="intentional-cache-invalidation">Intentional Cache Invalidation<a class="headerlink" href="#intentional-cache-invalidation" title="Permanent link">&para;</a></h4>
<p>Sometimes you need to invalidate caches globally or for a specific step (e.g., after a schema change or a bug fix that didn't change the config signature).</p>
<ul>
<li><strong>Global Invalidation</strong>: Increment <code>Tracker(cache_epoch=N)</code>. This bumps the version for every run in that tracker.</li>
<li><strong>Scenario Invalidation</strong>: Use <code>tracker.scenario(..., cache_epoch=N)</code>.</li>
<li><strong>Step Invalidation</strong>: Use <code>@define_step(cache_version=N)</code>.</li>
</ul>
<p>The <code>cache_epoch</code> and <code>cache_version</code> are folded into the run's identity hash, so a bump guarantees a cache miss.</p>
<p>For decorator defaults, callable metadata, and name templates, see
<strong><a href="../decorators-and-metadata/">Decorators &amp; Metadata</a></strong>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">tracker</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">run_dir</span><span class="o">=</span><span class="s2">&quot;runs&quot;</span><span class="p">,</span> <span class="n">cache_epoch</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nd">@define_step</span><span class="p">(</span><span class="n">cache_version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">simulate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="o">...</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="n">cache_epoch</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">sc</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">sc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">simulate</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th><code>cache_mode</code></th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>reuse</code> (default)</td>
<td>Reuse matching completed runs</td>
</tr>
<tr>
<td><code>overwrite</code></td>
<td>Always execute (no cache lookup)</td>
</tr>
<tr>
<td><code>readonly</code></td>
<td>Read cache but avoid persisting changes</td>
</tr>
</tbody>
</table>
<h3 id="artifact-identity-vs-bytes">Artifact Identity vs. Bytes<a class="headerlink" href="#artifact-identity-vs-bytes" title="Permanent link">&para;</a></h3>
<p>Consist distinguishes <strong>provenance identity</strong> (where an artifact came from, via <code>artifact.run_id</code>) from <strong>physical bytes</strong> (on-disk file contents).</p>
<p>For Consist-produced artifacts, inputs are hashed by linking to the producing run's signature (Merkle-style). For raw files (no <code>run_id</code>), Consist hashes file contents or metadata depending on configuration.</p>
<p>To skip hashing when you know the content hash (e.g., after copying a file), pass <code>content_hash=</code> to <code>log_artifact</code>. Consist ignores mismatched overrides unless <code>force_hash_override=True</code>. Use <code>validate_content_hash=True</code> to verify the override against on-disk data.</p>
<h3 id="portability-and-path-resolution">Portability and Path Resolution<a class="headerlink" href="#portability-and-path-resolution" title="Permanent link">&para;</a></h3>
<p>An artifact has a portable <code>artifact.container_uri</code> and a runtime-resolved <code>artifact.path</code>. Call <code>tracker.resolve_uri(uri)</code> to translate a portable URI into a host filesystem path using mounts.</p>
<p>On cache hits, Consist attaches cached output <code>Artifact</code> objects to the active run context. Code consumes <code>Artifact</code> objects and resolves paths through the tracker, keeping pipelines portable across machines.</p>
<hr />
<h2 id="pattern-1-step-caching-with-explicit-artifact-handoff">Pattern 1: Step Caching with Explicit Artifact Handoff<a class="headerlink" href="#pattern-1-step-caching-with-explicit-artifact-handoff" title="Permanent link">&para;</a></h2>
<p>For multi-step workflows, each step logs outputs as artifacts and the next step declares those artifacts as inputs.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">consist</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">consist</span><span class="w"> </span><span class="kn">import</span> <span class="n">use_tracker</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">ingest_raw</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="k">return</span> <span class="n">raw</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="k">with</span> <span class="n">use_tracker</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="k">with</span> <span class="n">consist</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="s2">&quot;my_scenario&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">scenario</span><span class="p">:</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="n">ingest_result</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ingest&quot;</span><span class="p">,</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>            <span class="n">fn</span><span class="o">=</span><span class="n">ingest_raw</span><span class="p">,</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>            <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;raw.csv&quot;</span><span class="p">)},</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">],</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>        <span class="p">)</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        <span class="n">transform_inputs</span> <span class="o">=</span> <span class="n">consist</span><span class="o">.</span><span class="n">refs</span><span class="p">(</span><span class="n">ingest_result</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">)</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        <span class="k">with</span> <span class="n">scenario</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>            <span class="s2">&quot;transform&quot;</span><span class="p">,</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>            <span class="n">inputs</span><span class="o">=</span><span class="n">transform_inputs</span><span class="p">,</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="p">):</span>  <span class="c1"># (1)!</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>            <span class="n">raw_art</span> <span class="o">=</span> <span class="n">transform_inputs</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span>  <span class="c1"># (2)!</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">consist</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">raw_art</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">)</span>
</span></code></pre></div>
<ol>
<li><code>inputs={...}</code> links to the exact upstream output artifact.</li>
<li><code>consist.refs(...)</code> builds a reusable explicit input mapping from the prior run result.</li>
</ol>
<p>Use <code>consist.ref(run_result, key="...")</code> for one-off links, or
<code>consist.refs(run_result, ...)</code> when wiring multiple linked inputs. Legacy
coupler-key indirection (<code>inputs=["raw"]</code>) still works, but it is not the
preferred pattern for new workflows.</p>
<div class="admonition note">
<p class="admonition-title">Step bodies execute on cache hits</p>
<p>Consist does not skip Python blocks. On cache hits, <code>tracker.log_artifact(..., direction="output")</code> returns the hydrated cached output when the <code>key</code> matches. If code produces a different output, Consist demotes the cache hit to an executing run.</p>
</div>
<h3 id="function-shaped-steps-skip-on-cache-hit">Function-Shaped Steps (Skip on Cache Hit)<a class="headerlink" href="#function-shaped-steps-skip-on-cache-hit" title="Permanent link">&para;</a></h3>
<p>Use <code>ScenarioContext.run(...)</code> to skip execution on cache hits. The <code>output_paths={...}</code> values are interpreted as relative paths (to <code>t.run_dir</code>), URI-like strings (resolved via mounts), or absolute paths.</p>
<hr />
<h2 id="pattern-2-cached-runs-with-consistrun">Pattern 2: Cached Runs with <code>consist.run</code><a class="headerlink" href="#pattern-2-cached-runs-with-consistrun" title="Permanent link">&para;</a></h2>
<p>Use <code>consist.run(...)</code> with declared outputs for cache-aware function execution.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="n">raw_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="o">...</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;cleaned&quot;</span><span class="p">:</span> <span class="n">cleaned_df</span><span class="p">}</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">consist</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">consist</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionOptions</span><span class="p">,</span> <span class="n">use_tracker</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="k">with</span> <span class="n">use_tracker</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">consist</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">fn</span><span class="o">=</span><span class="n">clean</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;raw_file&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;raw.csv&quot;</span><span class="p">)},</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cleaned&quot;</span><span class="p">],</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="n">execution_options</span><span class="o">=</span><span class="n">ExecutionOptions</span><span class="p">(</span><span class="n">load_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="pattern-3-resuming-after-failures">Pattern 3: Resuming After Failures<a class="headerlink" href="#pattern-3-resuming-after-failures" title="Permanent link">&para;</a></h2>
<p>When early steps succeed (and cache) but a late step fails, re-running reuses upstream cached results and continues from the failure point.</p>
<p>Requirements: upstream outputs are logged as artifacts, downstream steps declare those artifacts as inputs, and Consist only reuses completed runs. Re-running cache-hits earlier steps; the failed step re-executes because no valid completed run exists.</p>
<hr />
<h2 id="pattern-4-hot-vs-cold-data">Pattern 4: Hot vs. Cold Data<a class="headerlink" href="#pattern-4-hot-vs-cold-data" title="Permanent link">&para;</a></h2>
<p>See <a href="../data-materialization/">Data Materialization</a> for ingestion patterns, schema validation, and database fallback behavior.</p>
<hr />
<h2 id="what-happens-on-a-cache-hit">What Happens on a Cache Hit?<a class="headerlink" href="#what-happens-on-a-cache-hit" title="Permanent link">&para;</a></h2>
<h3 id="core-tracker-behavior">Core Tracker Behavior<a class="headerlink" href="#core-tracker-behavior" title="Permanent link">&para;</a></h3>
<p>On a cache hit, Consist:</p>
<ul>
<li>Finds a matching <strong>completed</strong> prior run with the same signature</li>
<li>Skips filesystem checks for cached outputs (for <code>run(...)</code>, use
  <code>cache_options=CacheOptions(validate_cached_outputs="eager")</code> to require files
  exist or are ingested)</li>
<li>Hydrates artifact objects into the current run context; paths resolve lazily via the active tracker</li>
</ul>
<p>On a cache hit, Consist does <strong>not</strong>:</p>
<ul>
<li>Copy files into a new run directory</li>
<li>Recreate missing files from DuckDB automatically</li>
<li>Guarantee that <code>artifact.path</code> exists on disk</li>
</ul>
<p>To access bytes: call <code>consist.load_df(...)</code> for DataFrames or <code>consist.load(...)</code> for Relations. Use <code>consist.load_relation(...)</code> as a context manager to ensure the DuckDB connection closes. Consist warns when active relation count exceeds <code>CONSIST_RELATION_WARN_THRESHOLD</code> (default 100).</p>
<h3 id="cache-misses-with-cached-inputs">Cache Misses with Cached Inputs<a class="headerlink" href="#cache-misses-with-cached-inputs" title="Permanent link">&para;</a></h3>
<p>If a run is not a cache hit but its inputs include artifacts from cached runs, those inputs are referenced by portable URIs (e.g., <code>./outputs/foo.parquet</code>). By default, URIs resolve to the current run directory, which may not contain bytes from the original run.</p>
<p>To extend a scenario in a new <code>run_dir</code> without re-running cached steps, use the cache hydration policy:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="s2">&quot;next_step&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">cached_artifact</span><span class="p">],</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;inputs-missing&quot;</span><span class="p">,</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">):</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>With <code>cache_hydration="inputs-missing"</code>, Consist detects missing input paths, locates the original run directory from provenance, and copies input bytes into the current <code>run_dir</code> before execution.</p>
<p>If the original file is missing but the artifact was ingested, Consist reconstructs inputs from DuckDB for CSV and Parquet artifacts only. Other drivers raise a <code>ValueError</code> to avoid silent or lossy conversions.</p>
<h3 id="optional-cache-hit-materialization">Optional Cache-Hit Materialization<a class="headerlink" href="#optional-cache-hit-materialization" title="Permanent link">&para;</a></h3>
<p>Consist supports opt-in materialization: copying bytes from a cached artifact's resolved path to a destination you provide. This is copy-only—it does not reconstruct files from DuckDB.</p>
<p>Enable at run start:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;outputs-all&quot;</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">materialize_cached_outputs_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;some/output/dir&quot;</span><span class="p">),</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">):</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>Materialize specific cached outputs by artifact key:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="s2">&quot;r2&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;outputs-requested&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">materialize_cached_output_paths</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;outputs/features.csv&quot;</span><span class="p">)},</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">):</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>Equivalent with <code>consist.run(...)</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">consist</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheOptions</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">consist</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">fn</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">cache_options</span><span class="o">=</span><span class="n">CacheOptions</span><span class="p">(</span><span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;outputs-requested&quot;</span><span class="p">),</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">output_paths</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;outputs/features.csv&quot;</span><span class="p">)},</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="p">)</span>
</span></code></pre></div>
<p>Default is <code>cache_hydration="metadata"</code> (artifact hydration only). For
<code>consist.run(...)</code> or <code>sc.run(...)</code>, use <code>output_paths={...}</code> with
<code>cache_options=CacheOptions(cache_hydration="outputs-requested")</code>.</p>
<table>
<thead>
<tr>
<th>Policy</th>
<th>Requires</th>
<th>Rejects</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>outputs-requested</code></td>
<td><code>materialize_cached_output_paths</code> or <code>output_paths</code></td>
<td><code>materialize_cached_outputs_dir</code></td>
</tr>
<tr>
<td><code>outputs-all</code></td>
<td><code>materialize_cached_outputs_dir</code></td>
<td><code>materialize_cached_output_paths</code></td>
</tr>
<tr>
<td><code>metadata</code> / <code>inputs-missing</code></td>
<td>—</td>
<td>Both materialization args</td>
</tr>
</tbody>
</table>
<p><code>outputs-requested</code> logs a warning for missing keys. <code>outputs-all</code> raises <code>FileNotFoundError</code> if any cached output source file is missing.</p>
<h3 id="containers-integration">Containers Integration<a class="headerlink" href="#containers-integration" title="Permanent link">&para;</a></h3>
<p>The containers API defaults to copying cached outputs to requested host output paths so downstream tooling sees real files. This uses the same copy-based materialization helper as core runs, but containers default to "requested outputs" because the caller explicitly provides host output paths.</p>
<hr />
<h2 id="hydration-policy-summary">Hydration Policy Summary<a class="headerlink" href="#hydration-policy-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Workflow</th>
<th><code>cache_hydration</code></th>
<th>When Bytes Copy</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fast cache hits</td>
<td><code>metadata</code></td>
<td>Never</td>
<td>Default; paths may not exist in new run dirs</td>
</tr>
<tr>
<td>Extend scenario in new <code>run_dir</code></td>
<td><code>inputs-missing</code></td>
<td>Cache misses, missing inputs only</td>
<td>Ensures executing steps read cached inputs</td>
</tr>
<tr>
<td>Materialize specific outputs</td>
<td><code>outputs-requested</code></td>
<td>Cache hits, requested outputs</td>
<td>Requires <code>materialize_cached_output_paths</code> or <code>output_paths</code></td>
</tr>
<tr>
<td>All outputs local</td>
<td><code>outputs-all</code></td>
<td>Cache hits, all outputs</td>
<td>Requires <code>materialize_cached_outputs_dir</code></td>
</tr>
</tbody>
</table>
<p>Use <code>metadata</code> (the default) unless downstream tools require files on disk.</p>
<hr />
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="../data-materialization/">Data Materialization</a></strong> — When to ingest data and use hybrid views</li>
<li><strong><a href="../config-management/">Config Management</a></strong> — How configuration affects cache invalidation</li>
</ul>
<hr />
<h2 id="practical-guidance">Practical Guidance<a class="headerlink" href="#practical-guidance" title="Permanent link">&para;</a></h2>
<h3 id="make-caching-predictable">Make Caching Predictable<a class="headerlink" href="#make-caching-predictable" title="Permanent link">&para;</a></h3>
<p>Declare all dependencies as inputs (<code>inputs=[...]</code> or task parameters). Keep configs deterministic—avoid embedding timestamps or randomness unless intended. Prefer stable code identity in tests (the Consist test suite patches the code hash for determinism).</p>
<h3 id="decide-what-to-ingest">Decide What to Ingest<a class="headerlink" href="#decide-what-to-ingest" title="Permanent link">&para;</a></h3>
<p>Ingest for queryable DuckDB tables, schema profiling, and optional recovery if files are deleted. Keep as cold files when you do not want to duplicate storage or artifacts are large and already in an external system.</p>
<h3 id="safe-deletion">Safe Deletion<a class="headerlink" href="#safe-deletion" title="Permanent link">&para;</a></h3>
<p>Delete artifacts when you are confident they will not be loaded again, or when they were ingested and you allow DB recovery (via <code>db_fallback="always"</code> or by declaring them as inputs). For aggressive GC while keeping provenance usable, use ingestion + intentional DB fallback.</p>
<hr />
<h2 id="cache-hit-performance-and-diagnostics">Cache-Hit Performance and Diagnostics<a class="headerlink" href="#cache-hit-performance-and-diagnostics" title="Permanent link">&para;</a></h2>
<p>Consist's cache-hit path minimizes filesystem work by default: <code>validate_cached_outputs="lazy"</code> skips per-output existence checks, and <code>cache_hydration="metadata"</code> avoids copying bytes.</p>
<h3 id="configuration-summary">Configuration Summary<a class="headerlink" href="#configuration-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Options</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cache_mode</code></td>
<td><code>reuse</code> (default), <code>overwrite</code>, <code>readonly</code></td>
</tr>
<tr>
<td><code>validate_cached_outputs</code></td>
<td><code>lazy</code> (default), <code>eager</code></td>
</tr>
<tr>
<td><code>cache_hydration</code></td>
<td><code>metadata</code> (default), <code>inputs-missing</code>, <code>outputs-requested</code>, <code>outputs-all</code></td>
</tr>
<tr>
<td><code>step_cache_hydration</code></td>
<td>Scenario-level default for all steps</td>
</tr>
<tr>
<td><code>materialize_cached_output_paths</code></td>
<td>Required for <code>outputs-requested</code></td>
</tr>
<tr>
<td><code>materialize_cached_outputs_dir</code></td>
<td>Required for <code>outputs-all</code></td>
</tr>
</tbody>
</table>
<p>For large iterative workflows, cache-hit time is spent fetching cached outputs and hashing raw-file inputs. Enable diagnostics:</p>
<ul>
<li><code>CONSIST_CACHE_TIMING=1</code>: logs timing for signature prefetch, input hashing, cache lookup, validation, hydration</li>
<li><code>CONSIST_CACHE_DEBUG=1</code>: logs cache hit/miss details and signatures</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>[cache_timing] signature_prefetch=2.1ms input_hashing=145.8ms cache_lookup=3.4ms validate=0.6ms hydration=0.2ms
</span></code></pre></div>
<p>If input hashing dominates, ingest large tabular inputs or pass Consist-produced artifacts instead of raw files.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>[cache_debug] hit=True signature=7e9c1c inputs=3 outputs=2 hydration=metadata
</span></code></pre></div>
<p>If downstream tools need files, select an outputs hydration mode. Use <code>validate_cached_outputs="eager"</code> for strict output existence checks.</p>
<hr />
<h2 id="pattern-5-shared-input-bundles">Pattern 5: Shared Input Bundles<a class="headerlink" href="#pattern-5-shared-input-bundles" title="Permanent link">&para;</a></h2>
<p>Package all required inputs in a standalone DuckDB file. Create a "bundle" run that logs inputs as outputs and ingests them. Share the DB file to reproduce inputs without shipping original raw files.</p>
<h3 id="bundle-creation-producer">Bundle Creation (Producer)<a class="headerlink" href="#bundle-creation-producer" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">tracker</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">run_dir</span><span class="o">=</span><span class="s2">&quot;bundle_build&quot;</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="s2">&quot;inputs.duckdb&quot;</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="s2">&quot;inputs_bundle_v1&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;input_bundle&quot;</span><span class="p">,</span> <span class="n">cache_mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">):</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">households</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;households.csv&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;households&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">persons</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;persons.csv&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;persons&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">tracker</span><span class="o">.</span><span class="n">ingest</span><span class="p">(</span><span class="n">households</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">tracker</span><span class="o">.</span><span class="n">ingest</span><span class="p">(</span><span class="n">persons</span><span class="p">)</span>
</span></code></pre></div>
<p>Run the bundle creation code once. Share <code>inputs.duckdb</code> with collaborators—they do not need the original CSV files.</p>
<h3 id="bundle-consumption-consumer">Bundle Consumption (Consumer)<a class="headerlink" href="#bundle-consumption-consumer" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">tracker</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">run_dir</span><span class="o">=</span><span class="s2">&quot;runs&quot;</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="s2">&quot;inputs.duckdb&quot;</span><span class="p">)</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">bundle_outputs</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">load_input_bundle</span><span class="p">(</span><span class="s2">&quot;inputs_bundle_v1&quot;</span><span class="p">)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bundle_outputs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="s2">&quot;simulate&quot;</span><span class="p">,</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;simulate&quot;</span><span class="p">,</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;inputs-missing&quot;</span><span class="p">,</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="p">):</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>The bundle is identified by <code>run_id</code> only—no hard-coded hashes. With <code>cache_hydration="inputs-missing"</code>, Consist reconstructs CSV/Parquet inputs from the shared DuckDB file if original bytes are missing.</p>
<h3 id="multi-model-workflows">Multi-Model Workflows<a class="headerlink" href="#multi-model-workflows" title="Permanent link">&para;</a></h3>
<p>Bundles contain inputs for multiple downstream steps. Each run selects the inputs it needs:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">bundle_outputs</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">load_input_bundle</span><span class="p">(</span><span class="s2">&quot;inputs_bundle_v1&quot;</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="s2">&quot;model_a&quot;</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;model_a&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">bundle_outputs</span><span class="p">[</span><span class="s2">&quot;input_a&quot;</span><span class="p">]],</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;inputs-missing&quot;</span><span class="p">,</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="p">):</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="o">...</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="k">with</span> <span class="n">tracker</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="s2">&quot;model_b&quot;</span><span class="p">,</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;model_b&quot;</span><span class="p">,</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">bundle_outputs</span><span class="p">[</span><span class="s2">&quot;input_b&quot;</span><span class="p">]],</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>    <span class="n">cache_hydration</span><span class="o">=</span><span class="s2">&quot;inputs-missing&quot;</span><span class="p">,</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">):</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="o">...</span>
</span></code></pre></div>














                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-circle-arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../decorators-and-metadata/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Decorators &amp;amp; Metadata">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-left" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7M19 12H5"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Decorators &amp; Metadata
              </div>
            </div>
          </a>
        
        
          
          <a href="../data-materialization/" class="md-footer__link md-footer__link--next" aria-label="Next: Data Virtualization &amp;amp; Materialization Strategy">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Data Virtualization &amp; Materialization Strategy
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-right" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 The Regents of the University of California, through Lawrence Berkeley National Laboratory

    </div>
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/LBNL-UCB-STI/consist" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../..","features":["announce.dismiss","content.action.view","content.code.annotate","content.code.copy","content.code.select","content.footnote.tooltips","content.tabs.link","content.tooltips","navigation.expand","navigation.footer","navigation.indexes","navigation.path","navigation.sections","navigation.tabs","navigation.top","navigation.tracking","search.highlight","toc.follow"],"search":"../../assets/javascripts/workers/search.e2d2d235.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5fcf0de6.min.js"></script>
      
    
  </body>
</html>